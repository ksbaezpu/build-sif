Bootstrap: docker-archive
From: ./debian13.2.tar

%labels
    Maintainer yangys
    App quantum-espresso-apt in debian 13.2

%post
    sed -i 's|deb.debian.org|mirrors.ustc.edu.cn|g' /etc/apt/sources.list.d/debian.sources
    sed -i 's|security.debian.org/debian-security|mirrors.ustc.edu.cn/debian-security|g' /etc/apt/sources.list.d/debian.sources

    apt-get update && apt-get install -y --no-install-recommends \
      quantum-espresso \
      quantum-espresso-data

    apt-get autoremove -y
    apt-get clean
    rm -rf /var/lib/apt/lists/* /root/.cache

%environment
    export OMPI_ALLOW_RUN_AS_ROOT=1
    export OMPI_ALLOW_RUN_AS_ROOT_CONFIRM=1
    export OMP_NUM_THREADS=1 # mpi priority

%runscript
    exec pw.x "$@"
